var L=Object.defineProperty;var N=(r,t,s)=>t in r?L(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var D=(r,t,s)=>N(r,typeof t!="symbol"?t+"":t,s);import{s as K,g as W,h as M,i as O,j as Y,k as G,l as J,m as F,n as Q,p as X,f as Z,q as A,v as $,x as ee,y as te,z as se,A as ae,B,_ as ne,c as E,a as l,C as j,D as q,E as S,G as U,F as H,r as re,H as oe,o as k,t as I}from"./DIneU_vK.js";const ie=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],ce=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",b=[];class de{constructor(){D(this,"_data",new P);D(this,"_hash",new P([...ie]));D(this,"_nDataBytes",0);D(this,"_minBufferSize",0)}finalize(t){t&&this._append(t);const s=this._nDataBytes*8,n=this._data.sigBytes*8;return this._data.words[n>>>5]|=128<<24-n%32,this._data.words[(n+64>>>9<<4)+14]=Math.floor(s/4294967296),this._data.words[(n+64>>>9<<4)+15]=s,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(t,s){const n=this._hash.words;let e=n[0],a=n[1],o=n[2],y=n[3],h=n[4],g=n[5],p=n[6],i=n[7];for(let u=0;u<64;u++){if(u<16)b[u]=t[s+u]|0;else{const c=b[u-15],w=(c<<25|c>>>7)^(c<<14|c>>>18)^c>>>3,m=b[u-2],T=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;b[u]=w+b[u-7]+T+b[u-16]}const v=h&g^~h&p,x=e&a^e&o^a&o,C=(e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22),d=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),_=i+d+v+ce[u]+b[u],f=C+x;i=p,p=g,g=h,h=y+_|0,y=o,o=a,a=e,e=_+f|0}n[0]=n[0]+e|0,n[1]=n[1]+a|0,n[2]=n[2]+o|0,n[3]=n[3]+y|0,n[4]=n[4]+h|0,n[5]=n[5]+g|0,n[6]=n[6]+p|0,n[7]=n[7]+i|0}_append(t){typeof t=="string"&&(t=P.fromUtf8(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(t){let s,n=this._data.sigBytes/64;t?n=Math.ceil(n):n=Math.max((n|0)-this._minBufferSize,0);const e=n*16,a=Math.min(e*4,this._data.sigBytes);if(e){for(let o=0;o<e;o+=16)this._doProcessBlock(this._data.words,o);s=this._data.words.splice(0,e),this._data.sigBytes-=a}return new P(s,a)}}class P{constructor(t,s){D(this,"words");D(this,"sigBytes");t=this.words=t||[],this.sigBytes=s===void 0?t.length*4:s}static fromUtf8(t){const s=unescape(encodeURIComponent(t)),n=s.length,e=[];for(let a=0;a<n;a++)e[a>>>2]|=(s.charCodeAt(a)&255)<<24-a%4*8;return new P(e,n)}toBase64(){const t=[];for(let s=0;s<this.sigBytes;s+=3){const n=this.words[s>>>2]>>>24-s%4*8&255,e=this.words[s+1>>>2]>>>24-(s+1)%4*8&255,a=this.words[s+2>>>2]>>>24-(s+2)%4*8&255,o=n<<16|e<<8|a;for(let y=0;y<4&&s*8+y*6<this.sigBytes*8;y++)t.push(le.charAt(o>>>6*(3-y)&63))}return t.join("")}concat(t){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let s=0;s<t.sigBytes;s++){const n=t.words[s>>>2]>>>24-s%4*8&255;this.words[this.sigBytes+s>>>2]|=n<<24-(this.sigBytes+s)%4*8}else for(let s=0;s<t.sigBytes;s+=4)this.words[this.sigBytes+s>>>2]=t.words[s>>>2];this.sigBytes+=t.sigBytes}}function ue(r){return new de().finalize(r).toBase64()}function he(r){return ue(K(r))}const fe=r=>r==="defer"||r===!1;function me(...r){var C;const t=typeof r[r.length-1]=="string"?r.pop():void 0;typeof r[0]!="string"&&r.unshift(t);let[s,n,e={}]=r;if(typeof s!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof n!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const a=W(),o=n,y=()=>M.value,h=()=>a.isHydrating?a.payload.data[s]:a.static.data[s];e.server??(e.server=!0),e.default??(e.default=y),e.getCachedData??(e.getCachedData=h),e.lazy??(e.lazy=!1),e.immediate??(e.immediate=!0),e.deep??(e.deep=M.deep),e.dedupe??(e.dedupe="cancel");const g=e.getCachedData(s,a),p=g!=null;if(!a._asyncData[s]||!e.immediate){(C=a.payload._errors)[s]??(C[s]=M.errorValue);const d=e.deep?O:Y;a._asyncData[s]={data:d(p?g:e.default()),pending:O(!p),error:G(a.payload._errors,s),status:O("idle"),_default:e.default}}const i={...a._asyncData[s]};delete i._default,i.refresh=i.execute=(d={})=>{if(a._asyncDataPromises[s]){if(fe(d.dedupe??e.dedupe))return a._asyncDataPromises[s];a._asyncDataPromises[s].cancelled=!0}if(d._initial||a.isHydrating&&d._initial!==!1){const f=d._initial?g:e.getCachedData(s,a);if(f!=null)return Promise.resolve(f)}i.pending.value=!0,i.status.value="pending";const _=new Promise((f,c)=>{try{f(o(a))}catch(w){c(w)}}).then(async f=>{if(_.cancelled)return a._asyncDataPromises[s];let c=f;e.transform&&(c=await e.transform(f)),e.pick&&(c=_e(c,e.pick)),a.payload.data[s]=c,i.data.value=c,i.error.value=M.errorValue,i.status.value="success"}).catch(f=>{if(_.cancelled)return a._asyncDataPromises[s];i.error.value=X(f),i.data.value=Z(e.default()),i.status.value="error"}).finally(()=>{_.cancelled||(i.pending.value=!1,delete a._asyncDataPromises[s])});return a._asyncDataPromises[s]=_,a._asyncDataPromises[s]},i.clear=()=>ye(a,s);const u=()=>i.refresh({_initial:!0}),v=e.server!==!1&&a.payload.serverRendered;{const d=A();if(d&&v&&e.immediate&&!d.sp&&(d.sp=[]),d&&!d._nuxtOnBeforeMountCbs){d._nuxtOnBeforeMountCbs=[];const c=d._nuxtOnBeforeMountCbs;$(()=>{c.forEach(w=>{w()}),c.splice(0,c.length)}),ee(()=>c.splice(0,c.length))}v&&a.isHydrating&&(i.error.value||g!=null)?(i.pending.value=!1,i.status.value=i.error.value?"error":"success"):d&&(a.payload.serverRendered&&a.isHydrating||e.lazy)&&e.immediate?d._nuxtOnBeforeMountCbs.push(u):e.immediate&&u();const _=Q();if(e.watch){const c=J(e.watch,()=>i.refresh());_&&F(c)}const f=a.hook("app:data:refresh",async c=>{(!c||c.includes(s))&&await i.refresh()});_&&F(f)}const x=Promise.resolve(a._asyncDataPromises[s]).then(()=>i);return Object.assign(x,i),x}function ye(r,t){t in r.payload.data&&(r.payload.data[t]=void 0),t in r.payload._errors&&(r.payload._errors[t]=M.errorValue),r._asyncData[t]&&(r._asyncData[t].data.value=void 0,r._asyncData[t].error.value=M.errorValue,r._asyncData[t].pending.value=!1,r._asyncData[t].status.value="idle"),t in r._asyncDataPromises&&(r._asyncDataPromises[t]&&(r._asyncDataPromises[t].cancelled=!0),r._asyncDataPromises[t]=void 0)}function _e(r,t){const s={};for(const n of t)s[n]=r[n];return s}function ge(r,t,s){const[n={},e]=[{},t],a=te(()=>B(r)),o=n.key||he([e,typeof a.value=="string"?a.value:"",...pe(n)]);if(!o||typeof o!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+o);if(!r)throw new Error("[nuxt] [useFetch] request is missing.");const y=o===e?"$f"+o:o;if(!n.baseURL&&typeof a.value=="string"&&a.value[0]==="/"&&a.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:h,lazy:g,default:p,transform:i,pick:u,watch:v,immediate:x,getCachedData:C,deep:d,dedupe:_,...f}=n,c=se({...ae,...f,cache:typeof n.cache=="boolean"?void 0:n.cache}),w={server:h,lazy:g,default:p,transform:i,pick:u,immediate:x,getCachedData:C,deep:d,dedupe:_,watch:v===!1?[]:[c,a,...v||[]]};let m;return me(y,()=>{var V;(V=m==null?void 0:m.abort)==null||V.call(m,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),m=typeof AbortController<"u"?new AbortController:{};const z=B(n.timeout);let R;return z&&(R=setTimeout(()=>m.abort(new DOMException("Request aborted due to timeout.","AbortError")),z),m.signal.onabort=()=>clearTimeout(R)),(n.$fetch||globalThis.$fetch)(a.value,{signal:m.signal,...c}).finally(()=>{clearTimeout(R)})},w)}function pe(r){var s;const t=[((s=B(r.method))==null?void 0:s.toUpperCase())||"GET",B(r.baseURL)];for(const n of[r.params||r.query]){const e=B(n);if(!e)continue;const a={};for(const[o,y]of Object.entries(e))a[B(o)]=B(y);t.push(a)}return t}const ve={data(){return{messages:[],username:"",connect:!1,socket:null,text:"",receiver:""}},methods:{async loadMessages(){let{data:r}=await ge(`/api/messages/${this.username}`,"$RcJmAH4yb5");this.messages=r,console.log(this.messages)},handleConnect(){this.username.length>0&&(this.loadMessages(),this.connect=!0,this.socket=oe("ws://localhost:3000"),this.socket.emit("logged_in",{username:this.username}),this.socket.on("chat message",r=>{this.messages.push({text:r.text,sender:r.username,receiver:r.receiver})}))},sendMessage(){this.socket.emit("chat message",{sender:this.username,text:this.text,receiver:this.receiver})}}},we={class:"container"},De={class:"row"},be={key:0,class:"col-4 from-container"},Be={class:"card"},xe={class:"card-body"},Ce={class:"mb-3"},Me={key:1,class:"col-4 form-container"},Pe={class:"card"},Ee={class:"card-body"},ke={class:"mb-3"},Re={class:"col-8 notes-container"},Oe={class:"card mb-3"},je={class:"card-body"},Se={class:"card-title"};function Ue(r,t,s,n,e,a){return k(),E(H,null,[t[7]||(t[7]=l("link",{href:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css",rel:"stylesheet",integrity:"sha384-QWTKZyjpPEjISv5WaRU90FeRpok6YctnYmDr5pNIyT2bRjXh®JMhjY6hW+ALEWIH",crossorigin:"anonymous"},null,-1)),t[8]||(t[8]=l("div",{class:"container py-3"},[l("h1",null," Чат")],-1)),l("div",we,[l("div",De,[e.connect?j("",!0):(k(),E("div",be,[l("form",{onSubmit:t[1]||(t[1]=q((...o)=>a.handleConnect&&a.handleConnect(...o),["prevent"]))},[l("div",Be,[l("div",xe,[l("div",Ce,[S(l("input",{type:"text",class:"form-control",placeholder:"Имя пользователя","onUpdate:modelValue":t[0]||(t[0]=o=>e.username=o)},null,512),[[U,e.username]])]),t[5]||(t[5]=l("button",{class:"btn btn-primary"},"Войти в чат",-1))])])],32)])),e.connect?(k(),E("div",Me,[l("form",{onSubmit:t[4]||(t[4]=q((...o)=>a.sendMessage&&a.sendMessage(...o),["prevent"]))},[l("div",Pe,[l("div",Ee,[l("div",ke,[S(l("textarea",{type:"text",class:"form-control",rows:"10","onUpdate:modelValue":t[2]||(t[2]=o=>e.text=o)},null,512),[[U,e.text]]),S(l("input",{type:"text",class:"form-control",placeholder:"Имя пользователя","onUpdate:modelValue":t[3]||(t[3]=o=>e.receiver=o)},null,512),[[U,e.receiver]])]),t[6]||(t[6]=l("button",{class:"btn btn-primary"},"Отприавть сообщение",-1))])])],32)])):j("",!0),l("div",Re,[e.connect?(k(!0),E(H,{key:0},re(e.messages,o=>(k(),E("div",Oe,[l("div",je,[l("h3",Se,[l("span",null,I(o.sender)+": "+I(o.text),1)])])]))),256)):j("",!0)])])])],64)}const Fe=ne(ve,[["render",Ue]]);export{Fe as default};
